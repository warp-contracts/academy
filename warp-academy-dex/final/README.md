# Final code for the Dex tutorial

This tutorial shows how to implement a simple token exchange.

## üí° The smart contract idea

Inspiration for this project is the [Uniswap](https://uniswap.org/) protocol, one of the most
successful Dapps in the history of Ethereum. It is so widely used, that in June 2022 the fees generated by Uniswap surpassed all the fees collected by Ethreum miners.
The key to the success of Uniswap is its ease of use. The implementation is based on the [Automatic Market Maker](https://www.coindesk.com/learn/2021/08/20/what-is-an-automated-market-maker/) model allowing users to change one token into another without the need of waiting for a counter-party. The idea was proposed in 2017 by Vitalik Buterin in a post describing a protocol that would allow a smart contract to perform swaps between tokens using a ratio of its reserves rather than an order book. The original idea was excellently implemented by [Hayden Adams](https://www.thedefiant.io/uniswap-fees-top-ethereum) creating one of the pillars of the emerging [DeFi](https://en.wikipedia.org/wiki/Decentralized_finance) movement.

The Automating Market Maker (AMM) uses a simple formula to determine the exchange rate between the two. It's called a **constant product function** and it can be expressed as:

```
x * y = k where x and y are the reserves
```

( amount of token X in DEX ) \* ( amount of token Y in DEX ) = k

The k is called an invariant because it doesn‚Äôt change during trades. (The k only changes as liquidity is added.) If we plot this formula, we‚Äôll get a curve that looks something like:

![AMM diagram](https://ethresear.ch/uploads/default/original/1X/5cde80046c11a2d4c30622a8362527a2973c195c.png)

(The picture is taken from V. Buterin [post](https://ethresear.ch/t/improving-front-running-resistance-of-x-y-k-market-makers/1281) about market makers)

A market controlled by this curve will automatically adapt the price according to the current supply and demand. As the ratio becomes more and more unbalanced, you will get less and less of the weaker asset from the same trade amount. Again, if the smart contract has too much token A and not enough token B, the price to swap tokens should be more desirable.

To work properly the AMM requires a certain amount of tokens to be deposited into the contract. These tokens are usually described as *liquidity* and the actors that supply them are called *liquidity providers*


## üôã‚Äç‚ôÇÔ∏è Need help?

Please feel free to contact us [on Discord](https://redstone.finance/discord) if you have any questions.

## üß∞ Prerequisites

- Prepared Node.js environment
- `yarn` installed
- Elementary Javascript coding skills
- Basic understanding of [SmartWeave](https://www.npmjs.com/package/warp-contracts) and
  [Warp](https://medium.com/@RedStone_Finance/prepare-for-warp-speed-b2a516120849) contracts

## üí™ What will you learn

- Deploying multiple contracts
- Implementing cross-contract interactions (aka [internal writes](https://academy.warp.cc/docs/sdk/advanced/internal-calls#internal-writes))
- Architecting a contract that may control other assets
- Fully understanding how one of the most important DeFi protocols works under the hood
  (Tons of satisfaction guaranteed :) )


## Install dependencies

Run:
`yarn`

## Build contract

```
yarn build
```

## Run tests

```
yarn test
```

